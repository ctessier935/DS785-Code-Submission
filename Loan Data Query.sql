-- Code used to join tables together, and loop through to remove unwanted columns to support data collection, cleaning, and preprocessing.

/*
Create temp table to store joined data based on established keys.
*/

DROP TABLE IF EXISTS #TempReportData;
SELECT ln.TableID,
       ln.CHARTERID,
       ln.BANKNUMBER,
       ln.PARTICIPATIONCODE,
       ln.DEALERNUMBER,
       ln.PROCAPPLCODE,
       ln.GENERALLEDGERTYPE,
       ln.PRODUCTCODE,
       ln.COSTCENTER,
       ln.ACCTGAPPLCODE,
       ln.NOTUSED,
       ln.PREPMTPENALTYTABLE,
       ln.CURRENTLOANSTATUS,
       ln.DAILYSTATUS,
       ln.MONTHLYSTATUS,
       ln.NODAYSATZEROBAL,
       ln.SYSTEMTYPE,
       ln.PAYSPLITOPTION,
       ln.PAYINADVFREQ,
       ln.PAYINADVINCR,
       ln.LOANCOMMAPPROVRD,
       ln.PAYMENTCALCTBLE,
       ln.STOPHOLDCODE,
       ln.PURPOSECODE,
       ln.CREDITRISKCODE,
       ln.CALLREPORTCODE,
       ln.EMPLOYEECODE,
       ln.IMPAIREDASSETSTAT,
       ln.AUTONONACCRDAYS,
       ln.AUTODYSOFFNA,
       ln.CONVERTSIMPLENA,
       ln.TRANSHOLDCODE,
       ln.RENEGOTIATEDCODE,
       ln.TICKLERCODE,
       ln.NOTICECODE,
       ln.INTRNLOANCLASSCDE,
       ln.REGLOANCLASSCODE,
       ln.STDINDUSTRIALCLASS,
       ln.CRBURACCTTYPECD,
       ln.CRBUREAUSTSOVRD,
       ln.CRBUREAUSPECSTS,
       ln.WAIVEFACTNOTICE,
       ln.PARTICIPATIONFLAG,
       ln.PRIMEFLAG,
       ln.COLLATERALFLAG,
       ln.RECORDLOCK,
       ln.FEEFLAG,
       ln.INSURANCEFLAG,
       ln.INTERESTFLAG,
       ln.RESERVEFLAG,
       ln.IMPAIREDASSETFLAG,
       ln.REALESTATEFLAG,
       ln.ESCROWFLAG,
       ln.SBALOANFLAG,
       ln.DEMANDFLAG,
       ln.OBLIGCOMMITFLAG,
       ln.ARMDISCLOSUREFLAG,
       ln.DEFERREDFEES,
       ln.REPOSSESSINDICATOR,
       ln.HISTORYCARDREQUEST,
       ln.CUSTLEVELPAYMENT,
       ln.PARTIALPAYMENTFLAG,
       ln.EARNINGSTYPE,
       ln.REBATETYPE,
       ln.INTERESTRATE,
       ln.ANNUALPCTRATE,
       ln.YEARBASE,
       ln.REBATEADJCODE,
       ln.INTERESTTERM,
       ln.REMINTERESTTERM,
       ln.ADDONAMORTTERM,
       ln.AMORTUNITPERIODS,
       ln.CURRBILLEDPMTAMT,
       ln.DEFAULTINTRATEFCT,
       ln.DEFAULTRATEPTR,
       ln.DEFAULTFREQCODE,
       ln.DEFAULTDAYS,
       ln.POSTMTYINTRTEFCT,
       ln.POSTMTYRATEPTR,
       ln.POSTMTYFREQCODE,
       ln.POSTMTYDAYS,
       ln.CRLINECTLCODE,
       ln.CRLINEEXPIRDATE,
       ln.CRLINEREVIEWDATE,
       ln.CRLINEREVIEWFREQ,
       ln.CRLINEREVIEWINCR,
       ln.CRLINEREVLEADDYS,
       ln.CRLINEMINADVAMT,
       ln.CRLNPROCCTLCODE,
       ln.BILLINGROUTINE,
       ln.BILLOPTION,
       ln.BILLSEQUENCE,
       ln.STMTCYCLE,
       ln.DATENEXTSTMT,
       ln.DATEPREVIOUSSTMT,
       ln.PRINCPOSTORDER,
       ln.ACCRPOSTORDER,
       ln.ESCROWPOSTORDER,
       ln.FEEPOSTORDER,
       ln.NOTUSED2,
       ln.LCPOSTORDER,
       ln.NEXTDUEDATE,
       ln.CURRENTMTYDATE,
       ln.FIRSTPAYMENTDATE,
       ln.LASTPAYMENTDATE,
       ln.LASTTRANSDATE,
       ln.ADVANCEDATE,
       ln.LSTBILLPRCYCDT,
       ln.LASTMAINTDATE,
       ln.LASTEXTNDATE,
       ln.LASTRIGHTTOCURE,
       ln.LASTSTATEMENTDATE,
       ln.CURRENTNOTEDATE,
       ln.BEGINEARNDATE,
       ln.ACCRUETHRUDATE,
       ln.NEXTEARNINGDATE,
       ln.EARNINGDAYOFMONTH,
       ln.CYCLEBEGINEARNDTE,
       ln.AGGRBEGINEARNDTE,
       ln.AGGRACCRTHRUDATE,
       ln.NEXTAGGRDATE,
       ln.INTFREEDATE,
       ln.DATEPRINPAIDTO,
       ln.DATEINTPAIDTO,
       ln.NONACCRUALDATE,
       ln.LASTTRWREPORTDATE,
       ln.BOARDINGDATE,
       ln.CONVERSIONDATE,
       ln.CLOSEDDATE,
       ln.CHARGEOFFDATE,
       ln.BACKDATELIMIT,
       ln.ORIGINALNOTEDATE,
       ln.ORIGINALLOANAMOUNT,
       ln.ORIGNETPROCEEDS,
       ln.ORIGINTERESTRATE,
       ln.ORIGMATURITYDATE,
       ln.ORIGINALSYSTEMTYPE,
       ln.PREPAIDINT,
       ln.PREPAIDPRIN,
       ln.PREPAIDESCROW,
       ln.PREPAIDECNMCACCR,
       ln.PREPAIDYTDINTEREST,
       ln.CURRENTLOANAMOUNT,
       ln.CURRENTPRINBALANCE,
       ln.AVAILABLEBALANCE,
       ln.TOTALDRAWS,
       ln.CURRENTESCRBALANCE,
       ln.SCHEDULEDBALANCE,
       ln.CURTAILMENTBALANCE,
       ln.UNAPPLIEDBALANCE,
       ln.PREPMTPENALTYAMT,
       ln.PAYOFFAMOUNT,
       ln.CLASSBALOLEM,
       ln.CLASSBALSUBSTD,
       ln.CLASSBALDOUBTFUL,
       ln.CLASSBALLOSS,
       ln.HIGHBALANCELTD,
       ln.LOWBALANCELTD,
       ln.HIGHBALANCEYTD,
       ln.LOWBALANCEYTD,
       ln.PRINCIPALBILLED,
       ln.PRINCIPALPAIDLTD,
       ln.INTERESTBILLED,
       ln.INTERESTEARNEDMTD,
       ln.INTERESTEARNEDQTD,
       ln.INTERESTEARNEDYTD,
       ln.INTERESTEARNEDLTD,
       ln.FRACACCRUEDINT,
       ln.INTERNDTOIMPDTE,
       ln.INTERNDSNCIMPDTE,
       ln.TOTALACCRUEDINT,
       ln.ORIGINTERESTAMOUNT,
       ln.UNEARNEDINT,
       ln.INTERESTREBATE,
       ln.MINIMUMREBATEAMT,
       ln.INTCAPITALIZEDLTD,
       ln.INTERESTPAIDYTD,
       ln.INTPAIDPREVYTD,
       ln.INTFREEACCR,
       ln.CYCLEACCR,
       ln.CYCLEFRACACCR,
       ln.INTACCRSINCELST,
       ln.INTPERDIEM219,
       ln.INTRATEYRBS99,
       ln.ECONOMICACCRLYTD,
       ln.LTCHGWAIVECODE,
       ln.LTCHGCODE,
       ln.LTCHGGRACEDAYS,
       ln.LTCHGFACTOR,
       ln.LTCHGBCRPOINTER,
       ln.PSTDUE1NTCSENT,
       ln.PSTDUE2NTCSENT,
       ln.PSTDUE3NTCSENT,
       ln.PSTDUE4NTCSENT,
       ln.PSTDUE5NTCSENT,
       ln.PSTDUE6NTCSENT,
       ln.LTCHGSASSESSEDLTD,
       ln.LATECHARGESDUE,
       ln.LTCHGASSDYTD,
       ln.LTCHGSPAIDLTD,
       ln.LTCHGSPAIDYTD,
       ln.LTCHGSPDPREVYTD,
       ln.LTCHGWVDLTD,
       ln.MAXLTCHGYTD,
       ln.MAXLTCHGLTD,
       ln.LCASSESSMENTCODE,
       ln.LCCOLLECTIONCODE,
       ln.DATELSTCOMPLPMT,
       ln.LTCHGAOIMPRDDT,
       ln.LTCHGSINCEIMPDT,
       ln.FEESBILLED,
       ln.INSURANCEBILLED,
       ln.FEESFINANCEDLTD,
       ln.FEESFINANCEDYTD,
       ln.FEESFINANCEDQTD,
       ln.FEESFINANCEDMTD,
       ln.FEESPAIDLTD,
       ln.FEESPAIDYTD,
       ln.FEESPAIDQTD,
       ln.FEESPAIDMTD,
       ln.PRIORYTD1098INT,
       ln.CURRYTD1098FEES,
       ln.PRIORYTD1098FEES,
       ln.LC1098RPTGFLAG,
       ln.ESCROWBILLED,
       ln.ESCROWCONSTANT,
       ln.NEEDESCROWANALYSIS,
       ln.REPORTESCROWON1099INT,
       ln.ESCROWUSERGROUPINGCODE,
       ln.ESCROWINTERESTPROFILE,
       ln.NEXTESCROWPAYMENT,
       ln.DATEOFNEXTESCROWPAYMENT,
       ln.ESCROWPAYMENTWITHOUTDEFICIENCY,
       ln.DATEESCROWPMTWITHOUTDEFICIENCY,
       ln.ESCROWPMTWITHOUTSURPLUS,
       ln.DATEESCROWPMTWITHOUTSURPLUS,
       ln.ESCROWPMTWITHOUTSHORTAGE,
       ln.DATEESCROWPMTWITHOUTSHORTAGE,
       ln.NEGATIVEESCROWTHRESHOLD,
       ln.DATEFIRSTANALYSIS,
       ln.DATELASTANALYSIS,
       ln.DATENEXTANALYSIS,
       ln.DATEESCROWBEGINACCRUAL,
       ln.DATEESCROWACCRUETHROUGH,
       ln.DATEESCROWNEXTINTPMT,
       ln.ESCROWINTERESTFREQUENCY,
       ln.ESCROWINTERESTINCREMENT,
       ln.ESCROWINTERESTDOM,
       ln.ESCROWINTERESTDISBURSEMENTMETHOD,
       ln.MTDESCROWINTERESTACCRUED,
       ln.QTDESCROWINTERESTACCRUED,
       ln.YTDESCROWINTERESTACCRUED,
       ln.LTDESCROWINTERESTACCRUED,
       ln.YTDESCROWINTERESTPAID,
       ln.PREVIOUSYTDESCRINTPAID,
       ln.MTDAGGREGATEESCRBALANCES,
       ln.MTDAGGRESCRBALANCESDAYS,
       ln.MTDAGGRESCRINTBALANCES,
       ln.MTDAGGRESCRINTBALSDAYS,
       ln.ESCROWACCRUEDINTEREST,
       ln.ESCROWFRACTIONALACCRUED,
       ln.ESCROWINTERESTPERDIEM,
       ln.ESCROWAGGREGATEACCRUED,
       ln.ESCROWAGGREGATEDAYS,
       ln.ESCROWSHORTAGEAMOUNT,
       ln.TOTALDUE,
       ln.TOTALPASTDUE,
       ln.PASTDUEPRINCIPAL,
       ln.PASTDUEINTEREST,
       ln.PASTDUERESERVEINT,
       ln.PASTDUEESCROW,
       ln.PASTDUEFEES,
       ln.PASTDUEINSURANCE,
       ln.NOOFDAYSPASTDUE,
       ln.PASTDUECOUNTER1,
       ln.PASTDUECOUNTER2,
       ln.PASTDUECOUNTER3,
       ln.PASTDUECOUNTER4,
       ln.PASTDUECOUNTER5,
       ln.PASTDUECOUNTER6,
       ln.RESERVEDISBMETH,
       ln.DEALERRECOURSECODE,
       ln.RESERVEYIELD,
       ln.NOTUSED3,
       ln.RESERVEINTBILLED,
       ln.RESERVEINTACCRUED,
       ln.RESERVEINTPAIDYTD,
       ln.FRACACCRRESINT,
       ln.RESACCRSINCELST,
       ln.RESPERDIEM115,
       ln.RESRATEYRBS99,
       ln.AGGRPRINCIPALMTD,
       ln.AGGRAVAILABLEMTD,
       ln.AGGRNOOFDAYSMTD,
       ln.AGGRPRINCIPALQTD,
       ln.AGGRAVAILABLEQTD,
       ln.AGGRNOOFDAYSQTD,
       ln.AGGRPRINCIPALYTD,
       ln.AGGRAVAILABLEYTD,
       ln.AGGRNOOFDAYSYTD,
       ln.AGGRPRINCIPALLTD,
       ln.AGGRAVAILABLELTD,
       ln.AGGRNOOFDAYSLTD,
       ln.AGGRPRINCIPALCTD,
       ln.AGGRAVAILABLECTD,
       ln.AGGRNOOFDAYSCTD,
       ln.USERDEFINED1,
       ln.USERDEFINED2,
       ln.USERDEFINED3,
       ln.USERDEFINED4,
       ln.USERDEFINED5,
       ln.USERDEFINED6,
       ln.USERDEFINED7,
       ln.USERDEFINED8,
       ln.USERDATE1,
       ln.USERDATE2,
       ln.USERDATE3,
       ln.USERDATE4,
       ln.USERDATE5,
       ln.USERDATE6,
       ln.USERDATE7,
       ln.USERDATE8,
       ln.CPNMAILLOCATION,
       ln.CPNPROCESSINGDATE,
       ln.CPNREORDERLEADDYS,
       ln.CPNPMTRECALCREORD,
       ln.CPNREPRINTFLAG,
       ln.CPNQUANTITY,
       ln.CPNMAXQTY,
       ln.GLOBALTIERRATE,
       ln.TIERMETHOD,
       ln.DEPACCT1APPL,
       ln.DEPACCT2APPL,
       ln.DEPACCT3APPL,
       ln.DEPACCT4APPL,
       ln.DEPACCT5APPL,
       ln.DEPACCT1ACCTNBR,
       ln.DEPACCT2ACCTNBR,
       ln.DEPACCT3ACCTNBR,
       ln.DEPACCT4ACCTNBR,
       ln.DEPACCT5ACCTNBR,
       ln.COMPBALTOUSE,
       ln.PCTOFCOMPBAL,
       ln.LTRCRCOUNTRYCODE,
       ln.LTRCRSTANDBYINDIC,
       ln.LTRCRCURRENCYIND,
       ln.LTRCRREDCLAUSE,
       ln.LTRCRREVOCABLEIND,
       ln.MAXLTCHGBCROVRD,
       ln.MINFINCHGBCROVRD,
       ln.LEADDAYSBCROVRD,
       ln.MTYLEADBILLOVRD,
       ln.ESCWRKFLD1,
       ln.ESCWRKFLD2,
       ln.PENALTYACCRINT,
       ln.ACQUISITIONBALANCE,
       ln.ACQUISITIONDATE,
       ln.NEXTRISKEVALUATION,
       ln.INITEXPDATE,
       ln.SPARERATE1,
       ln.SPARERATE2,
       ln.INITRATE,
       ln.INITIALARMDISCLOSURE,
       ln.RATECHANGEOCCURRED,
       ln.PROJECTIONFLAG,
       ln.PURCHASEDCODE,
       ln.NATEMPUSELOCKDYS,
       ln.SUBJECTTOMLA,
       ln.SPARE3CHARACTER1,
       ln.COMPOUNDINTERESTMETHOD,
       ln.RELATIONSHIPREPRICINGSTS,
       ln.SPARE4CHARACTER1,
       ln.SPARE4CHARACTER2,
       ln.SPARE4CHARACTER3,
       ln.SPARE5CHARACTER1,
       ln.SPARE5CHARACTER2,
       ln.SPARE5CHARACTER3,
       ln.SPARE10CHARACTER1,
       ln.SPARE10CHARACTER2,
       ln.SPARE10CHARACTER3,
       ln.SPARE5NUMERIC1,
       ln.SPARE5NUMERIC2,
       ln.SPARE5NUMERIC3,
       ln.NBREXTENSIONS,
       ln.NBRPMTSEXTENDED,
       ln.NBRRENEWALS,
       ln.BILLOVERLIMIT,
       ln.OVERLIMITPERCENT,
       ln.OVERLIMITAMOUNT,
       ln.OVERLIMITADVCODE,
       ln.ZROAVLFRQPASTDUE,
       ln.ZROAVLFRQEXPIRED,
       ln.ZROAVLFRQMATURED,
       ln.INTCODE,
       ln.DEFRATETYPE,
       ln.POSTMTYRATETYPE,
       ln.ZROAVLINCRPSTDUE,
       ln.ZROAVLINCREXPIRED,
       ln.ZROAVLINCRMATURED,
       ln.RATEINCRDAYS,
       ln.RATEDECRDAYS,
       ln.NOTUSEDFUTUREUSE,
       ln.NOITEMSRETRNDLTD,
       ln.NOITEMSRETRNDYTD,
       ln.NOITEMSRETRNDCYTD,
       ln.NOITEMSPRSNTDLTD,
       ln.NOITEMSPRSNTDYTD,
       ln.NOITEMSPRSNTDCYTD,
       ln.OVERLIMITSINCEDATE,
       ln.LASTOVERLIMITDATE,
       ln.LASTOVRLMTEXCDATE,
       ln.NAICSCODE,
       ln.DEFERLCOVERRIDE,
       ln.ACHFLAG,
       ln.ATMFLAG,
       ln.POSFLAG,
       ln.MEMOPOSTFLAG,
       ln.BEGAVAILBAL,
       ln.REGESTATMENT,
       ln.REGESTMTDATE,
       ln.HMDALOANFLAG,
       ln.HMDAPREAPPROVAL,
       ln.HOEPARATESPREAD,
       ln.REQUIREDLTV,
       ln.TOTALTRNSFRTRANCHE,
       ln.PREVBOSSESCROWBALANCE,
       ln.EXTRAAMOUNT3,
       ln.MINLTCHGBCROVRD,
       ln.EXTRAAMOUNT5,
       ln.PREVBOSSNEXTDUEDATE,
       ln.RTCHGBCKDTLIMIT,
       ln.AMORTENDDATE,
       ln.EXTRADATE4,
       ln.EXTRADATE5,
       ln.DEFAULTINTRATE,
       ln.POSTMTYINTRATE,
       ln.EXTRARATE3,
       ln.EXTRARATE4,
       ln.EXTRARATE5,
       ln.MASTERTRANCHEFLAG,
       ln.USECURRORIGPERCSOLDTOALLOCATEPYMTS,
       ln.PRINTHISTORY1098,
       ln.PROJECTPMTZERODUENTC,
       ln.WAIVEMISCNOTICESSTMTS,
       ln.INTERESTINARREARS,
       ln.SOFRLNFLAG,
       ln.CHARGEOFFCONTROLFLAG,
       ln.EXTRA3CHARCODE5,
       ln.CENSUSTRACT,
       ln.PROMOTIONALFIXEDRATE,
       ln.PROMOTIONALRATEINDEX,
       ln.PROMOTIONALADJFACTOR,
       ln.PROMOTIONALADJMETHOD,
       ln.PROMOTIONALEXPIRYDATE,
       ln.PERMANENTFIXEDRATE,
       COALESCE(ctrel.RELATTYPE, '') AS RELATTYPE,
       COALESCE(ctrel.PRIMARYRELATFLAG, '') AS PRIMARYRELATFLAG,
       COALESCE(ctrel.ORIGINALCOLLVALUE, 0) AS ORIGINALCOLLVALUE,
       COALESCE(ctrel.FIXEDAMOUNTOFVA, 0) AS FIXEDAMOUNTOFVA,
       COALESCE(ctrel.PERCENTAGEOFVALU, 0) AS PERCENTAGEOFVALU,
       COALESCE(ctrel.RELEASEDATE, '') AS RELEASEDATE,
       COALESCE(ctrel.MLSTAGEDRCDFLG, '') AS MLSTAGEDRCDFLG,
       COALESCE(ctrel.MAINTENANCEDATE, '') AS MAINTENANCEDATE,
       COALESCE(ctrel.BORRBASECERTCATGCODE, 0) AS BORRBASECERTCATGCODE,
       COALESCE(ctrel.BORRBASECERTDFTADVRATE, 0) AS BORRBASECERTDFTADVRATE,
       COALESCE(ctrel.LIENPOSITION, '') AS LIENPOSITION,
       COALESCE(ctrel.OVERRIDEAUTOMATICUPDATE, '') AS OVERRIDEAUTOMATICUPDATE,
       COALESCE(ctrel.ADDRESSFLAG1098, '') AS ADDRESSFLAG1098,
       COALESCE(ctrel.CHAR1SPARECODE4, '') AS CHAR1SPARECODE4,
       COALESCE(ctrel.CHAR1SPARECODE5, '') AS CHAR1SPARECODE5,
       COALESCE(ctrel.CHAR2SPARECODE1, '') AS CHAR2SPARECODE1,
       COALESCE(ctrel.CHAR2SPARECODE2, '') AS CHAR2SPARECODE2,
       COALESCE(ctrel.CHAR2SPARECODE3, '') AS CHAR2SPARECODE3,
       COALESCE(ctrel.CHAR2SPARECODE4, '') AS CHAR2SPARECODE4,
       COALESCE(ctrel.CHAR2SPARECODE5, '') AS CHAR2SPARECODE5,
       COALESCE(ctrel.PROPERTIESEXCESSOF1, '') AS PROPERTIESEXCESSOF1,
       COALESCE(ctrel.CHAR3SPARECODE2, '') AS CHAR3SPARECODE2,
       COALESCE(ctrel.CHAR3SPARECODE3, '') AS CHAR3SPARECODE3,
       COALESCE(ctrel.CHAR3SPARECODE4, '') AS CHAR3SPARECODE4,
       COALESCE(ctrel.CHAR3SPARECODE5, '') AS CHAR3SPARECODE5,
       COALESCE(ctrel.CHAR10SPARECODE1, '') AS CHAR10SPARECODE1,
       COALESCE(ctrel.CHAR10SPARECODE2, '') AS CHAR10SPARECODE2,
       COALESCE(ctrel.CHAR10SPARECODE3, '') AS CHAR10SPARECODE3,
       COALESCE(ctrel.CHAR10SPARECODE4, '') AS CHAR10SPARECODE4,
       COALESCE(ctrel.CHAR10SPARECODE5, '') AS CHAR10SPARECODE5,
       COALESCE(ctrel.CHAR20SPARECODE1, '') AS CHAR20SPARECODE1,
       COALESCE(ctrel.CHAR20SPARECODE2, '') AS CHAR20SPARECODE2,
       COALESCE(ctrel.CHAR20SPARECODE3, '') AS CHAR20SPARECODE3,
       COALESCE(ctrel.CHAR20SPARECODE4, '') AS CHAR20SPARECODE4,
       COALESCE(ctrel.CHAR20SPARECODE5, '') AS CHAR20SPARECODE5,
       COALESCE(ctrel.SPAREAMOUNT1, 0) AS SPAREAMOUNT1,
       COALESCE(ctrel.SPAREAMOUNT2, 0) AS SPAREAMOUNT2,
       COALESCE(ctrel.SPAREAMOUNT3, 0) AS SPAREAMOUNT3,
       COALESCE(ctrel.SPAREAMOUNT4, 0) AS SPAREAMOUNT4,
       COALESCE(ctrel.SPAREAMOUNT5, 0) AS SPAREAMOUNT5,
       COALESCE(ctrel.SPAREAMOUNT6, 0) AS SPAREAMOUNT6,
       COALESCE(ctrel.SPAREAMOUNT7, 0) AS SPAREAMOUNT7,
       COALESCE(ctrel.SPAREAMOUNT8, 0) AS SPAREAMOUNT8,
       COALESCE(ctrel.SPAREAMOUNT9, 0) AS SPAREAMOUNT9,
       COALESCE(ctrel.SPAREAMOUNT10, 0) AS SPAREAMOUNT10,
       COALESCE(ctrel.ACCTRELBREAKDATE, 0) AS ACCTRELBREAKDATE,
       COALESCE(ctrel.PARTIALRELEASEDATE, 0) AS PARTIALRELEASEDATE,
       COALESCE(ctrel.SPAREDATE3, 0) AS SPAREDATE3,
       COALESCE(ctrel.SPAREDATE4, 0) AS SPAREDATE4,
       COALESCE(ctrel.SPAREDATE5, 0) AS SPAREDATE5,
       COALESCE(ctrel.SPAREDATE6, 0) AS SPAREDATE6,
       COALESCE(ctrel.SPAREDATE7, 0) AS SPAREDATE7,
       COALESCE(ctrel.SPAREDATE8, 0) AS SPAREDATE8,
       COALESCE(ctrel.SPAREDATE9, 0) AS SPAREDATE9,
       COALESCE(ctrel.SPAREDATE10, 0) AS SPAREDATE10,
       COALESCE(ct.COLLATERALTYPE, '') AS COLLATERALTYPE,
       COALESCE(ct.DATEADDED, '') AS DATEADDED,
       COALESCE(ct.REVIEWPERIOD, '') AS REVIEWPERIOD,
       COALESCE(ct.REVIEWINCREMENT, 0) AS REVIEWINCREMENT,
       COALESCE(ct.REVIEWDATE, '') AS REVIEWDATE,
       COALESCE(ct.LASTREVIEWDATE, '') AS LASTREVIEWDATE,
       COALESCE(ct.EXPIRATIONDATE, '') AS EXPIRATIONDATE,
       COALESCE(ct.REPRICEPERIOD, '') AS REPRICEPERIOD,
       COALESCE(ct.REPRICEINCREMENT, 0) AS REPRICEINCREMENT,
       COALESCE(ct.REPRICEDATE, '') AS REPRICEDATE,
       COALESCE(ct.LASTREPRICEDATE, '') AS LASTREPRICEDATE,
       COALESCE(ct.UNITTYPE, '') AS UNITTYPE,
       COALESCE(ct.PRICEUNIT, 0) AS PRICEUNIT,
       COALESCE(ct.NUMBEROFUNITS, 0) AS NUMBEROFUNITS,
       COALESCE(ct.TOTALVALUE, 0) AS TOTALVALUE,
       COALESCE(ct.MARGIN, 0) AS MARGIN,
       COALESCE(ct.LOCATIONCODE, '') AS LOCATIONCODE,
       COALESCE(ct.SHORTDESCRIPTION, '') AS SHORTDESCRIPTION,
       COALESCE(ct.LONGDESCRIPTION1, '') AS LONGDESCRIPTION1,
       COALESCE(ct.LONGDESCRIPTION2, '') AS LONGDESCRIPTION2,
       COALESCE(ct.LONGDESCRIPTION3, '') AS LONGDESCRIPTION3,
       COALESCE(ct.LONGDESCRIPTION4, '') AS LONGDESCRIPTION4,
       COALESCE(ct.REPOSSESSIONDATE, '') AS REPOSSESSIONDATE,
       COALESCE(ct.DATECOLLATERALSOLD, '') AS DATECOLLATERALSOLD,
       COALESCE(ct.AMOUNTCOLLATERALSOLD, 0) AS AMOUNTCOLLATERALSOLD,
       COALESCE(ct.REPOSSESSIONSTATUS, '') AS REPOSSESSIONSTATUS,
       COALESCE(ct.ORIGINALPRICEVALUE, 0) AS ORIGINALPRICEVALUE,
       COALESCE(ct.PURGEDATE, '') AS PURGEDATE,
       COALESCE(ct.MAINTENANCEDATE, '') AS MAINTENANCEDATE2,
       COALESCE(ct.EXTRAAMOUNT1, 0) AS EXTRAAMOUNT1,
       COALESCE(ct.EXTRAAMOUNT2, 0) AS EXTRAAMOUNT2,
       COALESCE(ct.EXTRAAMOUNT3, 0) AS EXTRAAMOUNTS3,
       COALESCE(ct.EXTRADATE1, '') AS EXTRADATE1,
       COALESCE(ct.EXTRADATE2, '') AS EXTRADATE2,
       COALESCE(ct.EXTRADATE3, '') AS EXTRADATE3,
       COALESCE(ct.EXTRA1CHARCODE1, '') AS EXTRA1CHARCODE1,
       COALESCE(ct.EXTRA1CHARCODE2, '') AS EXTRA1CHARCODE2,
       COALESCE(ct.EXTRA1CHARCODE3, '') AS EXTRA1CHARCODE3,
       COALESCE(ct.EXTRA2CHARCODE1, '') AS EXTRA2CHARCODE1,
       COALESCE(ct.EXTRA2CHARCODE2, '') AS EXTRA2CHARCODE2,
       COALESCE(ct.EXTRA2CHARCODE3, '') AS EXTRA2CHARCODE3,
       COALESCE(ct.EXTRA3CHARCODE1, '') AS EXTRA3CHARCODE1,
       COALESCE(ct.EXTRA3CHARCODE2, '') AS EXTRA3CHARCODE2,
       COALESCE(ct.EXTRA3CHARCODE3, '') AS EXTRA3CHARCODE3,
       COALESCE(ct.EXTRA1NUMERIC1, 0) AS EXTRA1NUMERIC1,
       COALESCE(ct.EXTRA1NUMERIC2, 0) AS EXTRA1NUMERIC2,
       COALESCE(ct.EXTRA1NUMERIC3, 0) AS EXTRA1NUMERIC3,
       COALESCE(ct.EXTRA2NUMERIC1, 0) AS EXTRA2NUMERIC1,
       COALESCE(ct.EXTRA2NUMERIC2, 0) AS EXTRA2NUMERIC2,
       COALESCE(ct.EXTRA2NUMERIC3, 0) AS EXTRA2NUMERIC3,
       COALESCE(ct.EXTRA3NUMERIC1, 0) AS EXTRA3NUMERIC1,
       COALESCE(ct.EXTRA3NUMERIC2, 0) AS EXTRA3NUMERIC2,
       COALESCE(ct.EXTRA3NUMERIC3, 0) AS EXTRA3NUMERIC3
INTO #TempReportData
FROM dbo.LNMAST_Data ln
    LEFT JOIN dbo.CTACTREL_Data ctrel
        ON ctrel.CHARTERID = ln.CHARTERID
           AND ctrel.APPLICATION2 = 'LN'
           AND ctrel.ACCOUNTID2 = ln.ACCOUNTNUMBER
    LEFT JOIN dbo.CTMAST_Data ct
        ON ct.CHARTERID = ctrel.CHARTERID
           AND ct.COLLATERID = ctrel.ACCOUNTID
ORDER BY ln.CHARTERID,
         ln.TableID;


/*
Create a temp table to store the columns in table along with position for looping.
*/
DROP TABLE IF EXISTS #TableColumnSearch;
SELECT COLUMN_NAME,
       ORDINAL_POSITION,
       0 AS DistinctValueCount
INTO #TableColumnSearch
FROM tempdb.INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME LIKE '%TempReportData%'
ORDER BY ORDINAL_POSITION;


-- Declaring variables used for looping process and storing results.
DECLARE @TempResults TABLE
(
    TableID INT IDENTITY(1, 1),
    Column1 INT,
    Column2 NVARCHAR(50)
);
DECLARE @TableID INT = 0;
DECLARE @LoopEnd INT =
        (
            SELECT MAX(ORDINAL_POSITION)FROM #TableColumnSearch
        );
DECLARE @RunSQL NVARCHAR(MAX) = N'';
DECLARE @ColumnName VARCHAR(MAX) = '';

/*
Looping through the table of column names for dynamic sql to loop through and get distinct count of values.
*/
WHILE @TableID <= @LoopEnd
BEGIN


    SET @TableID = @TableID + 1;

    SET @ColumnName =
    (
        SELECT COLUMN_NAME
        FROM #TableColumnSearch
        WHERE ORDINAL_POSITION = @TableID
    );


    SET @RunSQL
        = N'SELECT agr.nmrc as Column1, ''' + @ColumnName
          + N''' as Column2 FROM (SELECT COUNT(*) AS nmrc FROM (SELECT DISTINCT ' + @ColumnName
          + N' FROM #TempReportData) tst)agr WHERE agr.nmrc = 1;';




    INSERT INTO @TempResults
    (
        Column1,
        Column2
    )
    EXEC sp_executesql @RunSQL;


END;

/*
Looping through to remove columns that only have no data in column.
*/
DECLARE @DeleteTableID INT = 0;
DECLARE @MaxDeleteTableID INT =
        (
            SELECT MAX(TableID)FROM @TempResults
        );
DECLARE @DeleteSQL NVARCHAR(MAX) = N'';
DECLARE @CurrentDeleteColumn VARCHAR(200) = '';
WHILE @DeleteTableID <= @MaxDeleteTableID
BEGIN

    SET @DeleteTableID = @DeleteTableID + 1;

    SET @CurrentDeleteColumn =
    (
        SELECT Column2 FROM @TempResults WHERE TableID = @DeleteTableID
    );



    SET @DeleteSQL = N'ALTER TABLE #TempReportData DROP COLUMN ' + @CurrentDeleteColumn;

    EXEC sp_executesql @DeleteSQL;

END;

/*
Selecting final data.
*/
SELECT * FROM #TempReportData